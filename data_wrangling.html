
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Data wrangling &#8212; ICESat-2 Sea Ice Thickness Data Analysis and Visualization</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.e2363ea40746bee74734a24ffefccd78.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="_static/logo.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Reading data from Google Cloud" href="utils/markdown_rendering/read_data_utils.html" />
    <link rel="prev" title="Atmospheric variables" href="atmospheric_variables.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">ICESat-2 Sea Ice Thickness Data Analysis and Visualization</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="home.html">
   ICESat-2 Sea Ice Thickness Data Analysis and Visualization
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  INTRO
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="is2_intro.html">
   Intro to the ATLAS/ICESat-2 Monthly Gridded Sea Ice Thickness Dataset
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  ANALYSIS &amp; VISUALIZATION
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="sea_ice_thickness.html">
   Sea ice thickness
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="sea_ice_characteristics.html">
   Sea ice characteristics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="sea_ice_drift.html">
   Sea ice drift vectors
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="atmospheric_variables.html">
   Atmospheric variables
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  DATA WRANGLING
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Data wrangling
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  HELPER FUNCTIONS
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="utils/markdown_rendering/read_data_utils.html">
   Reading data from Google Cloud
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="utils/markdown_rendering/plotting_utils.html">
   Plotting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="utils/markdown_rendering/misc_utils.html">
   Miscellaneous helper functions
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/data_wrangling.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/nicolejkeeney/icesat2-book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/nicolejkeeney/icesat2-book/issues/new?title=Issue%20on%20page%20%2Fdata_wrangling.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/nicolejkeeney/icesat2-book/edit/master/data_wrangling.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/nicolejkeeney/icesat2-book/master?urlpath=tree/data_wrangling.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Data wrangling
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#details-on-each-dataset">
     Details on each dataset
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#atlas-icesat-2-monthly-gridded-sea-ice-freeboard">
       ATLAS/ICESat-2 Monthly Gridded Sea Ice Freeboard
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#noaa-nsidc-climate-data-record-of-passive-microwave-sea-ice-concentration">
       NOAA/NSIDC Climate Data Record of Passive Microwave Sea Ice Concentration
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#nsidc-region-mask-and-coordinate-tools-psn25-v3">
       NSIDC region mask and coordinate tools (psn25 v3)
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#era5-monthly-averaged-data-on-single-levels">
       ERA5 monthly averaged data on single levels
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#piomas-mean-monthly-ice-thickness">
       PIOMAS mean monthly ice thickness
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#polar-pathfinder-daily-25-km-ease-grid-sea-ice-motion-vectors">
       Polar Pathfinder Daily 25 km EASE-Grid Sea Ice Motion Vectors
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#import-notebook-dependencies">
   1) Import notebook dependencies
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#read-in-data">
   2) Read in data
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#define-filepaths">
     Define filepaths
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-date-range-of-interest">
     Set date range of interest
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#icesat-2-gridded-monthly-means">
     ICESat-2 gridded monthly means
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sea-ice-concentration">
     Sea ice concentration
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#remove-flagged-concentration-data">
       Remove flagged concentration data
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nsidc-region-mask-and-coordinate-tools-for-the-arctic">
     NSIDC region mask and coordinate tools for the Arctic
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#era5-climate-reanalysis">
     ERA5 climate reanalysis
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#piomas-sea-ice-thickness">
     PIOMAS sea ice thickness
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nsidc-sea-ice-motion-vectors">
     NSIDC sea ice motion vectors
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#regrid-all-datasets-to-icesat-2-grid">
   3) Regrid all datasets to ICESat-2 grid
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Sea ice concentration
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     ERA5 climate reanalysis
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     PIOMAS sea ice thickness
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sea-ice-motion-vectors">
     Sea ice motion vectors
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#interpolate-icesat-2-variables">
   4) Interpolate ICESat-2 variables
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#compile-and-save-final-dataset">
   5) Compile and save final dataset
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#combine-datasets">
     Combine datasets
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-region-mask-as-a-coordinate-to-the-final-dataset">
     Add region mask as a coordinate to the final dataset
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#save-data-to-local-machine-as-a-netcdf4-file">
     Save data to local machine as a netcdf4 file
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="data-wrangling">
<h1>Data wrangling<a class="headerlink" href="#data-wrangling" title="Permalink to this headline">¶</a></h1>
<p>This notebook loads the different datasets used in the analysis into a single NETCDF4 file, with descriptive attributes maintained for each dataset. Each dataset is regridded to the ICESat2 grid shape [304, 448] (x,y). The datasets used in this notebook are listed below. The output file is accessible in the <a class="reference external" href="https://console.cloud.google.com/storage/browser/sea-ice-thickness-data">google cloud storage bucket</a> for this jupyter book and loaded in each notebook.</p>
<div class="section" id="details-on-each-dataset">
<h2>Details on each dataset<a class="headerlink" href="#details-on-each-dataset" title="Permalink to this headline">¶</a></h2>
<p>Detailed information about each of the datasets used to compile the final data product are provided below in the order they appear in the notebook workflow. The information provided here was last updated 08-21-2021.</p>
<div class="section" id="atlas-icesat-2-monthly-gridded-sea-ice-freeboard">
<h3>ATLAS/ICESat-2 Monthly Gridded Sea Ice Freeboard<a class="headerlink" href="#atlas-icesat-2-monthly-gridded-sea-ice-freeboard" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><strong>Product Type</strong>: Northern hemisphere gridded monthly means</p></li>
<li><p><strong>Download link</strong>:</p>
<ul>
<li><p>NSIDC (recommended method): <a class="reference external" href="https://nsidc.org/data/ATL20">https://nsidc.org/data/ATL20</a></p></li>
<li><p>Our google storage bucket (provided for compatibility with this Jupyter Book): <a class="reference external" href="https://console.cloud.google.com/storage/browser/sea-ice-thickness-data">https://console.cloud.google.com/storage/browser/sea-ice-thickness-data</a></p></li>
</ul>
</li>
<li><p><strong>Reference</strong>: Petty, A. A., R. Kwok, M. Bagnardi, A. Ivanoff, N. Kurtz, J. Lee, J. Wimert, and D. Hancock. 2021. ATLAS/ICESat-2 L3B Daily and Monthly Gridded Sea Ice Freeboard, Version 2. Northern hemisphere gridded monthly means. Boulder, Colorado USA. NASA National Snow and Ice Data Center Distributed Active Archive Center. doi: <a class="reference external" href="https://doi.org/10.5067/ATLAS/ATL20.002">https://doi.org/10.5067/ATLAS/ATL20.002</a>. 08-21-2021.</p></li>
</ul>
</div>
<div class="section" id="noaa-nsidc-climate-data-record-of-passive-microwave-sea-ice-concentration">
<h3>NOAA/NSIDC Climate Data Record of Passive Microwave Sea Ice Concentration<a class="headerlink" href="#noaa-nsidc-climate-data-record-of-passive-microwave-sea-ice-concentration" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><strong>Variables used</strong>: NOAA/NSIDC sea ice concentration CDR</p></li>
<li><p><strong>Download link</strong>: <a class="reference external" href="https://nsidc.org/data/g02202">https://nsidc.org/data/g02202</a></p></li>
<li><p><strong>Reference</strong>: Meier, W. N., F. Fetterer, A. K. Windnagel, and S. Stewart. 2021. NOAA/NSIDC Climate Data Record of Passive Microwave Sea Ice Concentration, Version 4. Mean monthly aggregated, northern hemisphere. Boulder, Colorado USA. NSIDC: National Snow and Ice Data Center <a class="reference external" href="https://doi.org/10.7265/efmz-2t65">https://doi.org/10.7265/efmz-2t65</a>. 08-21-2021.</p></li>
<li><p><strong>NOTE</strong>: Only the aggregated monthly dataset has latitude and longitude variables, so make sure you download this file!</p></li>
</ul>
</div>
<div class="section" id="nsidc-region-mask-and-coordinate-tools-psn25-v3">
<h3>NSIDC region mask and coordinate tools (psn25 v3)<a class="headerlink" href="#nsidc-region-mask-and-coordinate-tools-psn25-v3" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><strong>Product names</strong>: region_n.msk (region mask); psn25lons_v3.dat &amp; psn25lats_v3.dat (coordinate tool)</p></li>
<li><p><strong>Download links</strong>:</p>
<ul>
<li><p>Region mask: <a class="reference external" href="https://nsidc.org/data/polar-stereo/tools_masks.html#region_masks">https://nsidc.org/data/polar-stereo/tools_masks.html#region_masks</a></p></li>
<li><p>Coordinate tools: <a class="reference external" href="https://nsidc.org/data/polar-stereo/tools_geo_pixel.html">https://nsidc.org/data/polar-stereo/tools_geo_pixel.html</a></p></li>
</ul>
</li>
<li><p><strong>Reference</strong>: unknown (if you know the reference for this product and would like to contribute it, please suggest an edit)</p></li>
</ul>
</div>
<div class="section" id="era5-monthly-averaged-data-on-single-levels">
<h3>ERA5 monthly averaged data on single levels<a class="headerlink" href="#era5-monthly-averaged-data-on-single-levels" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><strong>Variables used</strong>: 2m temperature; Mean surface downward long-wave radiation flux</p></li>
<li><p><strong>Product type</strong>: Monthly averaged reanalysis</p></li>
<li><p><strong>Download link</strong>: <a class="reference external" href="https://cds.climate.copernicus.eu/cdsapp#%21/dataset/reanalysis-era5-single-levels-monthly-means">https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-single-levels-monthly-means</a></p></li>
<li><p><strong>Reference</strong>: Hersbach, H., Bell, B., Berrisford, P., Biavati, G., Horányi, A., Muñoz Sabater, J., Nicolas, J., Peubey, C., Radu, R., Rozum, I., Schepers, D., Simmons, A., Soci, C., Dee, D., Thépaut, J-N. (2019): ERA5 monthly averaged data on single levels from 1979 to present. Copernicus Climate Change Service (C3S) Climate Data Store (CDS). (Accessed on 16-08-2021), 10.24381/cds.f17050d7</p></li>
</ul>
</div>
<div class="section" id="piomas-mean-monthly-ice-thickness">
<h3>PIOMAS mean monthly ice thickness<a class="headerlink" href="#piomas-mean-monthly-ice-thickness" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><strong>Product Type</strong>: Sea ice thickness (Volume per unit Area), monthly mean</p></li>
<li><p><strong>Variables used</strong>: Sea ice thickness (Volume per unit Area) monthly mean; Grid lon and lat for scalar fields (txt file)</p></li>
<li><p><strong>Download link</strong>: <a class="reference external" href="http://psc.apl.uw.edu/research/projects/arctic-sea-ice-volume-anomaly/data/model_grid">http://psc.apl.uw.edu/research/projects/arctic-sea-ice-volume-anomaly/data/model_grid</a></p></li>
<li><p><strong>Reference</strong>: Zhang, Jinlun and D.A. Rothrock: Modeling global sea ice with a thickness and enthalpy distribution model in generalized curvilinear coordinates, Mon. Wea. Rev. 131(5), 681-697, 2003.</p></li>
<li><p><strong>NOTE</strong>: You’ll want to download the heff format data product, not the text file. For some reason, just clicking on the gzipped file to unzip it raises an error on my computer that the archive is empty (which is not true!). You’ll need to unzip the file using the command line; i.e. <code class="docutils literal notranslate"><span class="pre">gzip</span> <span class="pre">-d</span> <span class="pre">file.gz</span></code></p></li>
</ul>
</div>
<div class="section" id="polar-pathfinder-daily-25-km-ease-grid-sea-ice-motion-vectors">
<h3>Polar Pathfinder Daily 25 km EASE-Grid Sea Ice Motion Vectors<a class="headerlink" href="#polar-pathfinder-daily-25-km-ease-grid-sea-ice-motion-vectors" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><strong>Product Type</strong>: Ice motion Northern Hemisphere weekly means</p></li>
<li><p><strong>Download link</strong>: <a class="reference external" href="https://nsidc.org/data/nsidc-0116">https://nsidc.org/data/nsidc-0116</a></p></li>
<li><p><strong>Reference</strong>: Tschudi, M., W. N. Meier, J. S. Stewart, C. Fowler, and J. Maslanik. 2019. Polar Pathfinder Daily 25 km EASE-Grid Sea Ice Motion Vectors, Version 4. Ice motion Northern Hemisphere weekly means . Boulder, Colorado USA. NASA National Snow and Ice Data Center Distributed Active Archive Center. doi: <a class="reference external" href="https://doi.org/10.5067/INAWUWO7QH7B">https://doi.org/10.5067/INAWUWO7QH7B</a>. 08-16-2021.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Although you’ll see an option to run this notebook in Binder, this notebook is <strong>NOT</strong> configured to run in Binder. If you want to wrangle the data yourself, each dataset used to compile the final data product can be downloaded from the links above. The final data product produced by this notebook can be downloaded from the google storage bucket associated with this jupyter book.</p>
</div>
</div>
</div>
</div>
<div class="section" id="import-notebook-dependencies">
<h1>1) Import notebook dependencies<a class="headerlink" href="#import-notebook-dependencies" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>
<span class="kn">import</span> <span class="nn">pyproj</span> 
<span class="kn">import</span> <span class="nn">scipy.interpolate</span> 
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">utils.read_data_utils</span> <span class="kn">import</span> <span class="n">read_is2_data</span> <span class="c1"># This allows us to read the ICESAT2 data directly from the google storage bucket</span>
<span class="kn">from</span> <span class="nn">utils.misc_utils</span> <span class="kn">import</span> <span class="n">create_empty_xr_ds</span> <span class="c1"># Allows you to fill in empty data to overcome data coverage issues </span>
<span class="kn">from</span> <span class="nn">utils.misc_utils</span> <span class="kn">import</span> <span class="n">is2_interp2d</span> <span class="c1"># Interpolate ICESat2 variables using CDR data </span>

<span class="c1"># Ignore warnings in the notebook to improve display</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="read-in-data">
<h1>2) Read in data<a class="headerlink" href="#read-in-data" title="Permalink to this headline">¶</a></h1>
<div class="section" id="define-filepaths">
<h2>Define filepaths<a class="headerlink" href="#define-filepaths" title="Permalink to this headline">¶</a></h2>
<p>Define filepaths to data on your local machine</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cdr_path</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>         <span class="c1"># NOAA/NSIDC Climate Data Record of Passive Microwave Sea Ice Concentration</span>
<span class="n">regionMask_path</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>  <span class="c1"># NSIDC region mask and coordinate tools (psn25 v3)</span>
<span class="n">ERA5_path</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>        <span class="c1"># ERA5 monthly averaged data on single levels</span>
<span class="n">PIOMAS_path</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>      <span class="c1"># PIOMAS mean monthly ice thickness</span>
<span class="n">drift_path</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>       <span class="c1"># Polar Pathfinder Daily 25 km EASE-Grid Sea Ice Motion Vectors</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="set-date-range-of-interest">
<h2>Set date range of interest<a class="headerlink" href="#set-date-range-of-interest" title="Permalink to this headline">¶</a></h2>
<p>We’ll restrict data to this date range, corresponding to years/months in our later analysis</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start_date</span> <span class="o">=</span> <span class="s2">&quot;Nov 2018&quot;</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="s2">&quot;Apr 2021&quot;</span>
<span class="n">date_range</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;MS&#39;</span><span class="p">)</span> <span class="c1"># MS indicates a time frequency of start of the month</span>
<span class="nb">print</span><span class="p">(</span><span class="n">date_range</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DatetimeIndex([&#39;2018-11-01&#39;, &#39;2018-12-01&#39;, &#39;2019-01-01&#39;, &#39;2019-02-01&#39;,
               &#39;2019-03-01&#39;, &#39;2019-04-01&#39;, &#39;2019-05-01&#39;, &#39;2019-06-01&#39;,
               &#39;2019-07-01&#39;, &#39;2019-08-01&#39;, &#39;2019-09-01&#39;, &#39;2019-10-01&#39;,
               &#39;2019-11-01&#39;, &#39;2019-12-01&#39;, &#39;2020-01-01&#39;, &#39;2020-02-01&#39;,
               &#39;2020-03-01&#39;, &#39;2020-04-01&#39;, &#39;2020-05-01&#39;, &#39;2020-06-01&#39;,
               &#39;2020-07-01&#39;, &#39;2020-08-01&#39;, &#39;2020-09-01&#39;, &#39;2020-10-01&#39;,
               &#39;2020-11-01&#39;, &#39;2020-12-01&#39;, &#39;2021-01-01&#39;, &#39;2021-02-01&#39;,
               &#39;2021-03-01&#39;, &#39;2021-04-01&#39;],
              dtype=&#39;datetime64[ns]&#39;, freq=&#39;MS&#39;)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="icesat-2-gridded-monthly-means">
<h2>ICESat-2 gridded monthly means<a class="headerlink" href="#icesat-2-gridded-monthly-means" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">is2_ds</span> <span class="o">=</span> <span class="n">read_is2_data</span><span class="p">(</span><span class="n">data_dir</span><span class="o">=</span><span class="s2">&quot;IS2SITMOGR4&quot;</span><span class="p">)</span>
<span class="n">is2_ds</span> <span class="o">=</span> <span class="n">is2_ds</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;xgrid&quot;</span><span class="p">,</span><span class="s2">&quot;ygrid&quot;</span><span class="p">])</span> <span class="c1"># Drop unneeded coords </span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="sea-ice-concentration">
<h2>Sea ice concentration<a class="headerlink" href="#sea-ice-concentration" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">read_cdr_data</span><span class="p">(</span><span class="n">filepaths</span><span class="p">,</span> <span class="n">varname</span><span class="o">=</span><span class="s2">&quot;cdr_seaice_conc_monthly&quot;</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot;Reads in CDR data, renames coordinates, and sets lat/lon variables to coordinates</span>
<span class="sd">    Selects one variable, defined by varname, and returns a DataArray with descriptive attributes for the entire dataset </span>
<span class="sd">    </span>
<span class="sd">     Args:</span>
<span class="sd">         filepaths (list of str): paths to CDR files </span>
<span class="sd">         varname (str, optional): name of variable to select (default to &quot;cdr_seaice_conc_monthly&quot;, monthly sea ice concentration)</span>
<span class="sd">         </span>
<span class="sd">     Returns: </span>
<span class="sd">         cdr_da (xr.DataArray): data </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">xr_rename_coords</span><span class="p">(</span><span class="n">da</span><span class="p">):</span>
        <span class="n">da</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s2">&quot;tdim&quot;</span><span class="p">:</span><span class="s2">&quot;time&quot;</span><span class="p">,</span><span class="s2">&quot;xgrid&quot;</span><span class="p">:</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="s2">&quot;ygrid&quot;</span><span class="p">:</span><span class="s2">&quot;y&quot;</span><span class="p">})</span> <span class="c1"># Rename coordinates to match dimensions </span>
        <span class="k">return</span> <span class="n">da</span>
    
    <span class="n">cdr_ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">filepaths</span><span class="p">,</span> 
                               <span class="n">concat_dim</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> 
                               <span class="n">combine</span><span class="o">=</span><span class="s1">&#39;nested&#39;</span><span class="p">,</span> 
                               <span class="n">preprocess</span><span class="o">=</span><span class="n">xr_rename_coords</span><span class="p">)</span>
    <span class="n">cdr_ds</span> <span class="o">=</span> <span class="n">cdr_ds</span><span class="o">.</span><span class="n">set_coords</span><span class="p">([</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span><span class="s2">&quot;longitude&quot;</span><span class="p">])</span> <span class="c1"># Set lat and lon as coordinates </span>
    <span class="n">cdr_da</span> <span class="o">=</span> <span class="n">cdr_ds</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span> <span class="c1"># Select one variable from Dataset</span>
    <span class="n">cdr_da</span> <span class="o">=</span> <span class="n">cdr_da</span><span class="o">.</span><span class="n">sortby</span><span class="p">(</span><span class="n">variables</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Sort by time ascending</span>

    <span class="c1"># Add descriptive attributes from main Dataset </span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;metadata_link&quot;</span><span class="p">,</span><span class="s2">&quot;contributor_name&quot;</span><span class="p">,</span><span class="s2">&quot;contributor_role&quot;</span><span class="p">,</span><span class="s2">&quot;license&quot;</span><span class="p">,</span><span class="s2">&quot;summary&quot;</span><span class="p">]:</span>
        <span class="n">cdr_da</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">cdr_ds</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> 
    <span class="n">cdr_da</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;reference&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Meier, W. N., F. Fetterer, A. K. Windnagel, and S. Stewart. 2021. NOAA/NSIDC Climate Data Record of Passive Microwave Sea Ice Concentration, Version 4. Mean monthly aggregated, northern hemisphere. Boulder, Colorado USA. NSIDC: National Snow and Ice Data Center https://doi.org/10.7265/efmz-2t65. 08-21-2021.&quot;</span>
    
    <span class="k">return</span> <span class="n">cdr_da</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Paths to data </span>
<span class="n">cdr_nrt_filepaths</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="n">cdr_path</span><span class="o">+</span><span class="s2">&quot;NRT/*.nc&quot;</span><span class="p">)</span>  <span class="c1">#NRT data, available as single netcdf files by month in 2021 </span>
<span class="n">cdr_agg</span> <span class="o">=</span> <span class="n">cdr_path</span><span class="o">+</span><span class="s2">&quot;seaice_conc_monthly_nh_197811_202012_v04r00.nc&quot;</span> <span class="c1"># Aggreggated monthly data, in one file 1979-2020</span>

<span class="c1"># Read in data </span>
<span class="n">cdr_da</span> <span class="o">=</span> <span class="n">read_cdr_data</span><span class="p">(</span><span class="n">filepaths</span><span class="o">=</span><span class="n">cdr_nrt_filepaths</span><span class="o">+</span><span class="p">[</span><span class="n">cdr_agg</span><span class="p">],</span> <span class="n">varname</span><span class="o">=</span><span class="s2">&quot;cdr_seaice_conc_monthly&quot;</span><span class="p">)</span>
<span class="n">cdr_da</span> <span class="o">=</span> <span class="n">cdr_da</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span> <span class="o">=</span> <span class="n">date_range</span><span class="p">)</span> <span class="c1"># Select desired date range set at top of notebook </span>
<span class="n">cdr_da</span> <span class="o">=</span> <span class="n">cdr_da</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cdr_da</span><span class="o">.</span><span class="n">latitude</span> <span class="o">&gt;</span> <span class="n">is2_ds</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="c1"># Restrict to ICESat-2 latitude</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="remove-flagged-concentration-data">
<h3>Remove flagged concentration data<a class="headerlink" href="#remove-flagged-concentration-data" title="Permalink to this headline">¶</a></h3>
<p>Remove data on land and at the pole hole, which are assigned an aphysical value greater than 1</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cdr_da</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Before removing flagged data&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/data_wrangling_18_0.png" src="_images/data_wrangling_18_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Remove data &gt; 1</span>
<span class="n">cdr_da</span> <span class="o">=</span> <span class="n">cdr_da</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cdr_da</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Plot</span>
<span class="n">cdr_da</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;After removing flagged data&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/data_wrangling_19_0.png" src="_images/data_wrangling_19_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="nsidc-region-mask-and-coordinate-tools-for-the-arctic">
<h2>NSIDC region mask and coordinate tools for the Arctic<a class="headerlink" href="#nsidc-region-mask-and-coordinate-tools-for-the-arctic" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">getRegionMask</span><span class="p">(</span><span class="n">dataPath</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot;Gets NSIDC region mask for map projection</span>
<span class="sd">    </span>
<span class="sd">     Args:</span>
<span class="sd">         dataPath (str): path to NSIDC region mask</span>
<span class="sd">         </span>
<span class="sd">     Returns: </span>
<span class="sd">         shapedMask (numpy array): NSIDC arctic region mask gridded to shape [448, 304]</span>
<span class="sd">         shapedLons (numpy array): longitudes gridded to shape [448, 304]</span>
<span class="sd">         shapedLats (numpy array): latitudes gridded to shape [448, 304] </span>
<span class="sd">    &quot;&quot;&quot;</span> 
    <span class="n">gridShape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">448</span><span class="p">,</span> <span class="mi">304</span><span class="p">]</span> <span class="c1"># Shape of grid to reshape data to </span>
    
    <span class="n">regionMask</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">dataPath</span> <span class="o">+</span> <span class="s1">&#39;/sect_fixed_n.msk&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="c1"># Open region mask </span>
    <span class="n">shapedMask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">file</span> <span class="o">=</span> <span class="n">regionMask</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;uint8&#39;</span><span class="p">),</span> <span class="n">gridShape</span><span class="p">)</span> <span class="c1"># Reshape mask to grid shape</span>
    
    <span class="n">maskLons</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">dataPath</span> <span class="o">+</span> <span class="s1">&#39;/psn25lons_v3.dat&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="c1"># Open region mask longitudes</span>
    <span class="n">maskLats</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">dataPath</span> <span class="o">+</span> <span class="s1">&#39;/psn25lats_v3.dat&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="c1"># Open region mask latitudes</span>
    <span class="n">shapedLons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">file</span> <span class="o">=</span> <span class="n">maskLons</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;&lt;i4&#39;</span><span class="p">)</span><span class="o">/</span><span class="mf">100000.</span><span class="p">,</span> <span class="n">gridShape</span><span class="p">)</span> <span class="c1"># Reshape longitudes to grid shape</span>
    <span class="n">shapedLats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">file</span> <span class="o">=</span> <span class="n">maskLats</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;&lt;i4&#39;</span><span class="p">)</span><span class="o">/</span><span class="mf">100000.</span><span class="p">,</span> <span class="n">gridShape</span><span class="p">)</span> <span class="c1"># Reshape latitudes to grid shape</span>

    <span class="k">return</span> <span class="n">shapedMask</span><span class="p">,</span> <span class="n">shapedLons</span><span class="p">,</span> <span class="n">shapedLats</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read in data</span>
<span class="n">regionMask</span><span class="p">,</span> <span class="n">maskLons</span><span class="p">,</span> <span class="n">maskLats</span> <span class="o">=</span> <span class="n">getRegionMask</span><span class="p">(</span><span class="n">regionMask_path</span><span class="p">)</span>

<span class="c1"># Coords and attributes for region mask</span>
<span class="c1"># This will be used later to add as a coordinate to the final dataset </span>
<span class="n">regionMaskCoords</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;region_mask&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="n">regionMask</span><span class="p">)}</span>
<span class="n">regionMaskKeys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">])</span>
<span class="n">regionMaskLabels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;Lakes, extended coast&#39;</span><span class="p">,</span><span class="s1">&#39;non-region oceans&#39;</span><span class="p">,</span> <span class="s1">&#39;Sea of Okhotsk and Japan&#39;</span><span class="p">,</span><span class="s1">&#39;Bering Sea&#39;</span><span class="p">,</span><span class="s1">&#39;Hudson Bay&#39;</span><span class="p">,</span><span class="s1">&#39;Gulf of St. Lawrence&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Baffin Bay, Davis Strait &amp; Labrador Sea&#39;</span><span class="p">,</span><span class="s1">&#39;Greenland Sea&#39;</span><span class="p">,</span> <span class="s1">&#39;Barents Seas&#39;</span><span class="p">,</span><span class="s1">&#39;Kara Sea&#39;</span><span class="p">,</span><span class="s1">&#39;Laptev Sea&#39;</span><span class="p">,</span><span class="s1">&#39;East Siberian Sea&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Chukchi Sea&#39;</span><span class="p">,</span><span class="s1">&#39;Beaufort Sea&#39;</span><span class="p">,</span><span class="s1">&#39;Canadian Archipelago&#39;</span><span class="p">,</span><span class="s1">&#39;Arctic Ocean&#39;</span><span class="p">,</span><span class="s1">&#39;Land&#39;</span><span class="p">,</span><span class="s1">&#39;Coast&#39;</span><span class="p">])</span>
<span class="n">regionMaskAttrs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;NSIDC region mask for the Arctic&#39;</span><span class="p">,</span> 
                   <span class="s1">&#39;keys&#39;</span><span class="p">:</span> <span class="n">regionMaskKeys</span><span class="p">,</span> <span class="s1">&#39;labels&#39;</span> <span class="p">:</span> 
                   <span class="n">regionMaskLabels</span><span class="p">,</span> <span class="s1">&#39;note&#39;</span><span class="p">:</span> <span class="s1">&#39;keys and labels ordered to match by index&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="era5-climate-reanalysis">
<h2>ERA5 climate reanalysis<a class="headerlink" href="#era5-climate-reanalysis" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read data </span>
<span class="n">ERA5</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">ERA5_path</span><span class="p">)</span>
<span class="n">ERA5</span> <span class="o">=</span> <span class="n">ERA5</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span> <span class="o">=</span> <span class="n">date_range</span><span class="p">)</span> <span class="c1"># Select for date range of interest</span>
<span class="n">ERA5</span> <span class="o">=</span> <span class="n">ERA5</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ERA5</span><span class="o">.</span><span class="n">latitude</span> <span class="o">&gt;</span> <span class="n">is2_ds</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="c1"># Restrict to ICESat-2 latitude</span>
<span class="n">ERA5</span> <span class="o">=</span> <span class="n">ERA5</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">expver</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;expver&#39;</span><span class="p">)</span> <span class="c1"># Remove weird variable</span>

<span class="c1"># Convert t2m temperature from Kelvin to Celcius </span>
<span class="n">tempCelcius</span> <span class="o">=</span> <span class="n">ERA5</span><span class="p">[</span><span class="s1">&#39;t2m&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">283.15</span>
<span class="n">tempCelcius</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span> <span class="c1"># Change units attribute to C (Celcius)</span>
<span class="n">tempCelcius</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;2 meter temperature&#39;</span>
<span class="n">ERA5</span> <span class="o">=</span> <span class="n">ERA5</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">t2m</span> <span class="o">=</span> <span class="n">tempCelcius</span><span class="p">)</span> <span class="c1">#Add to dataset as a new data variable</span>

<span class="c1"># Add descriptive attributes </span>
<span class="n">ERA5</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;era5 monthly averaged data on single levels from 1979 to present&#39;</span><span class="p">,</span> 
              <span class="s1">&#39;website&#39;</span><span class="p">:</span> <span class="s1">&#39;https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-single-levels-monthly-means?tab=overview&#39;</span><span class="p">,</span> 
              <span class="s1">&#39;contact&#39;</span><span class="p">:</span> <span class="s1">&#39;copernicus-support@ecmwf.int&#39;</span><span class="p">,</span>
              <span class="s1">&#39;citation&#39;</span><span class="p">:</span> <span class="s1">&#39;Copernicus Climate Change Service (C3S) (2017): ERA5: Fifth generation of ECMWF atmospheric reanalyses of the global climate . Copernicus Climate Change Service Climate Data Store (CDS), July 2020. https://cds.climate.copernicus.eu/cdsapp#!/home&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="piomas-sea-ice-thickness">
<h2>PIOMAS sea ice thickness<a class="headerlink" href="#piomas-sea-ice-thickness" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_piomas_data</span><span class="p">(</span><span class="n">date_range</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot; Read in a PIOMAS yearly files and convert to an xr.DataArray object </span>
<span class="sd">    </span>
<span class="sd">    Args: </span>
<span class="sd">        date_range (pandas DatetimeIndex): date range to grab data for </span>
<span class="sd">        data_dir (str): directory containing data on local drive </span>
<span class="sd">    </span>
<span class="sd">    Returns: </span>
<span class="sd">        PIO_da (xr.DataArray): dataset object containing data for input date range</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">start_year</span> <span class="o">=</span> <span class="n">date_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">year</span>
    <span class="n">end_year</span> <span class="o">=</span> <span class="n">date_range</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">year</span>

    <span class="n">pio_by_yr</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span> 

        <span class="c1"># Most recent year may not have a complete year of data</span>
        <span class="c1"># We need to reshape the data to match the number of months available, such that the shape of the numpy array is [month, 120, 360]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">12</span><span class="p">:</span> 
            <span class="n">data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">data_dir</span> <span class="o">+</span> <span class="s1">&#39;heff.H&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">),</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> 
            <span class="k">try</span><span class="p">:</span> 
                <span class="n">pio_np</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">file</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;f&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">360</span><span class="p">]))</span>
                <span class="k">break</span>
            <span class="k">except</span><span class="p">:</span> 
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">pio_by_yr</span> <span class="o">+=</span> <span class="p">(</span><span class="n">pio_np</span><span class="p">)</span>
        
    <span class="c1"># Get latitude and longitude </span>
    <span class="n">gridP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">data_dir</span> <span class="o">+</span> <span class="s1">&#39;grid.dat.txt&#39;</span><span class="p">)</span>
    <span class="n">lonsP</span> <span class="o">=</span> <span class="n">gridP</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4320</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">lonsP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">lonsP</span><span class="p">,</span> <span class="p">[</span><span class="mi">120</span><span class="p">,</span><span class="mi">360</span><span class="p">])</span>
    <span class="n">latsP</span> <span class="o">=</span> <span class="n">gridP</span><span class="p">[</span><span class="mi">4320</span><span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">latsP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">latsP</span><span class="p">,</span> <span class="p">[</span><span class="mi">120</span><span class="p">,</span><span class="mi">360</span><span class="p">])</span>

    <span class="c1"># Load dataList as an xr.DataArray and add descriptive attributes and coordinates</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">start_year</span><span class="p">),</span> <span class="n">end</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">end_year</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">freq</span> <span class="o">=</span> <span class="s1">&#39;MS&#39;</span><span class="p">)</span>
    <span class="n">PIOMAS_da</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">pio_by_yr</span><span class="p">,</span> 
                             <span class="n">dims</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> 
                             <span class="n">coords</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">time</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="n">lonsP</span><span class="p">),</span> <span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="n">latsP</span><span class="p">)},</span> 
                             <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;meters&#39;</span><span class="p">,</span> 
                                      <span class="s1">&#39;long_name&#39;</span><span class="p">:</span> <span class="s1">&#39;PIOMAS sea ice thickness&#39;</span><span class="p">,</span> 
                                      <span class="s1">&#39;data_download&#39;</span><span class="p">:</span> <span class="s1">&#39;http://psc.apl.uw.edu/research/projects/arctic-sea-ice-volume-anomaly/data/&#39;</span><span class="p">,</span> 
                                      <span class="s1">&#39;download_date&#39;</span><span class="p">:</span> <span class="s1">&#39;08-2020&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;citation&#39;</span><span class="p">:</span> <span class="s1">&#39;Zhang, J.L. and D.A. Rothrock, “Modeling global sea ice with a thickness and enthalpy distribution model in generalized curvilinear coordinates“, Mon. Weather Rev., 131, 845-861, 2003&#39;</span><span class="p">},</span> 
                             <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;piomas_ice_thickness&quot;</span><span class="p">)</span>
    <span class="n">PIOMAS_da</span> <span class="o">=</span> <span class="n">PIOMAS_da</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span> <span class="o">=</span> <span class="n">date_range</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">PIOMAS_da</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pio_da</span> <span class="o">=</span> <span class="n">get_piomas_data</span><span class="p">(</span><span class="n">date_range</span><span class="o">=</span><span class="n">date_range</span><span class="p">,</span> <span class="n">data_dir</span><span class="o">=</span><span class="n">PIOMAS_path</span><span class="p">)</span>
<span class="n">pio_da</span> <span class="o">=</span> <span class="n">pio_da</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">date_range</span><span class="p">)</span> <span class="c1"># Select for date range of interest</span>
<span class="n">pio_da</span> <span class="o">=</span> <span class="n">pio_da</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pio_da</span><span class="o">.</span><span class="n">latitude</span> <span class="o">&gt;</span> <span class="n">is2_ds</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="c1"># Restrict to ICESat-2 latitude </span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="nsidc-sea-ice-motion-vectors">
<h2>NSIDC sea ice motion vectors<a class="headerlink" href="#nsidc-sea-ice-motion-vectors" title="Permalink to this headline">¶</a></h2>
<p>As of Aug 2021, this dataset does not have data for 2021, so I create an empty dataset filled with nans for Jan - Apr 2021</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_uv_from_xy</span><span class="p">(</span><span class="n">xdrift</span><span class="p">,</span> <span class="n">ydrift</span><span class="p">,</span> <span class="n">lon</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;convert the drift vectors to zonal/meridional, and calculate magnitude</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">lon</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span> <span class="c1">#convert longitudes to radians </span>
        <span class="n">uvelT</span> <span class="o">=</span> <span class="n">ydrift</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">+</span> <span class="n">xdrift</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">vvelT</span> <span class="o">=</span> <span class="n">ydrift</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">-</span> <span class="n">xdrift</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">vectorMag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">uvelT</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vvelT</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">uvelT</span><span class="p">,</span> <span class="n">vvelT</span><span class="p">,</span> <span class="n">vectorMag</span>

<span class="k">def</span> <span class="nf">getDriftData</span><span class="p">(</span><span class="n">dataPath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Gets weekly NSIDC sea ice drift data for the Arctic, resamples monthly, and returns a dataset</span>
<span class="sd">    </span>
<span class="sd">    Args: </span>
<span class="sd">        dataPath (str): path to local directory of weekly drift data </span>

<span class="sd">    Returns: </span>
<span class="sd">        monthlyDrifts (xarray DataArray): sea ice drift data, resampled to monthly means, with descriptive coordinates and attributes</span>
<span class="sd">        </span>
<span class="sd">    Note: This function uses two different datasets from the NSIDC for drift in order to get the most recent data. Drift dataset from 1978-2018 was combined with quicklook drift dataset from 2019-present, maintaining attitributes of the 1978-2018 dataset</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1">#combine nc weekly files into a single xarray dataset</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">dataPath</span> <span class="o">+</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dataPath</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">dataPath</span> <span class="o">+</span> <span class="n">f</span><span class="p">)</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.nc&#39;</span><span class="p">)]</span>
    <span class="n">weeklyDrifts</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sortby</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>

    <span class="c1">#get transformed u,v variables and add to dataset</span>
    <span class="n">uvelT</span><span class="p">,</span> <span class="n">vvelT</span><span class="p">,</span> <span class="n">vectorMag</span> <span class="o">=</span> <span class="n">get_uv_from_xy</span><span class="p">(</span><span class="n">weeklyDrifts</span><span class="o">.</span><span class="n">u</span><span class="p">,</span> <span class="n">weeklyDrifts</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">weeklyDrifts</span><span class="o">.</span><span class="n">longitude</span><span class="p">)</span>
    <span class="n">weeklyDrifts</span> <span class="o">=</span> <span class="n">weeklyDrifts</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">drifts_uT</span> <span class="o">=</span> <span class="n">uvelT</span><span class="p">,</span> <span class="n">drifts_vT</span> <span class="o">=</span> <span class="n">vvelT</span><span class="p">,</span> <span class="n">drifts_magnitude</span> <span class="o">=</span> <span class="n">vectorMag</span><span class="p">)</span>
    
    <span class="c1">#resample to get monthly data </span>
    <span class="n">monthlyDrifts</span> <span class="o">=</span> <span class="n">weeklyDrifts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;MS&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="c1">#convert to same time format as ICESat-2 </span>
    <span class="n">monthlyDrifts</span> <span class="o">=</span> <span class="n">monthlyDrifts</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">time</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m-</span><span class="si">%d</span><span class="s1">-%Y&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">monthlyDrifts</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span><span class="p">])</span>
    
    <span class="c1">#add attributes</span>
    <span class="n">monthlyDrifts</span><span class="o">.</span><span class="n">drifts_uT</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;description&#39;</span><span class="p">:</span><span class="s1">&#39;along-x component of the ice motion (u variable) converted to zonal/meridional&#39;</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">:</span><span class="s1">&#39;cm/s&#39;</span><span class="p">,</span> <span class="s1">&#39;long_name&#39;</span><span class="p">:</span><span class="s1">&#39;sea ice x velocity&#39;</span><span class="p">}</span>
    <span class="n">monthlyDrifts</span><span class="o">.</span><span class="n">drifts_vT</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;description&#39;</span><span class="p">:</span><span class="s1">&#39;along-y component of the ice motion (v variable) converted to zonal/meridional&#39;</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">:</span><span class="s1">&#39;cm/s&#39;</span><span class="p">,</span> <span class="s1">&#39;long_name&#39;</span><span class="p">:</span><span class="s1">&#39;sea ice y velocity&#39;</span><span class="p">}</span>
    <span class="n">monthlyDrifts</span><span class="o">.</span><span class="n">drifts_magnitude</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;long_name&#39;</span><span class="p">:</span> <span class="s1">&#39;drift vector magnitude&#39;</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">:</span><span class="s1">&#39;cm/s&#39;</span><span class="p">}</span>
    <span class="n">monthlyDrifts</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;njkeeney comment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;drift dataset from 1978-2018 was combined with quicklook drift dataset from 2019-present, maintaining attitributes of the 1978-2018 dataset&#39;</span>
    <span class="n">monthlyDrifts</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;citation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Tschudi, M., W. N. Meier, J. S. Stewart, C. Fowler, and J. Maslanik. 2019. Polar Pathfinder Daily 25 km EASE-Grid Sea Ice Motion Vectors, Version 4. Weekly sea ice motion. Boulder, Colorado USA. NASA National Snow and Ice Data Center Distributed Active Archive Center. doi: https://doi.org/10.5067/INAWUWO7QH7B. July 2020.&#39;</span>
    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">monthlyDrifts</span><span class="o">.</span><span class="n">data_vars</span><span class="p">:</span> 
        <span class="k">if</span> <span class="n">var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;drifts_magnitude&#39;</span><span class="p">,</span><span class="s1">&#39;drifts_uT&#39;</span><span class="p">,</span> <span class="s1">&#39;drifts_vT&#39;</span><span class="p">]:</span> 
            <span class="n">monthlyDrifts</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">weeklyDrifts</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span> <span class="c1">#resampling function causes attributes to be lost, so add them back here</span>
    
    <span class="k">return</span> <span class="n">monthlyDrifts</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">drifts</span> <span class="o">=</span> <span class="n">getDriftData</span><span class="p">(</span><span class="n">dataPath</span><span class="o">=</span><span class="n">drifts_path</span><span class="p">)</span>
<span class="n">drifts</span> <span class="o">=</span> <span class="n">drifts</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">drifts</span><span class="o">.</span><span class="n">latitude</span> <span class="o">&gt;</span> <span class="n">drifts</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="c1"># Restrict to ICESat-2 latitude </span>

<span class="c1"># Create empty dataset for 2021 since drifts is missing data </span>
<span class="n">drifts_empty_2021</span> <span class="o">=</span> <span class="n">create_empty_xr_ds</span><span class="p">(</span><span class="n">xr_ds</span><span class="o">=</span><span class="n">drifts</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="s2">&quot;2021-01&quot;</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="s2">&quot;2021-04&quot;</span><span class="p">)</span>
<span class="n">drifts</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">([</span><span class="n">drifts</span><span class="p">,</span> <span class="n">drifts_empty_2021</span><span class="p">])</span>
<span class="n">drifts</span> <span class="o">=</span> <span class="n">drifts</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">date_range</span><span class="p">)</span> <span class="c1"># Select for date range of interest</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="regrid-all-datasets-to-icesat-2-grid">
<h1>3) Regrid all datasets to ICESat-2 grid<a class="headerlink" href="#regrid-all-datasets-to-icesat-2-grid" title="Permalink to this headline">¶</a></h1>
<p>In order to merge all the datasets into a singe netcdf4 file, they need to be on the same grid.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">regridToICESat2</span><span class="p">(</span><span class="n">dataArrayNEW</span><span class="p">,</span> <span class="n">xptsNEW</span><span class="p">,</span> <span class="n">yptsNEW</span><span class="p">,</span> <span class="n">xptsIS2</span><span class="p">,</span> <span class="n">yptsIS2</span><span class="p">):</span>  
    <span class="sd">&quot;&quot;&quot; Regrid new data to ICESat-2 grid </span>
<span class="sd">    </span>
<span class="sd">    Args: </span>
<span class="sd">        dataArrayNEW (xarray DataArray): DataArray to be gridded to ICESat-2 grid </span>
<span class="sd">        xptsNEW (numpy array): x-values of dataArrayNEW projected to ICESat-2 map projection </span>
<span class="sd">        yptsNEW (numpy array): y-values of dataArrayNEW projected to ICESat-2 map projection </span>
<span class="sd">        xptsIS2 (numpy array): ICESat-2 longitude projected to ICESat-2 map projection</span>
<span class="sd">        yptsIS2 (numpy array): ICESat-2 latitude projected to ICESat-2 map projection</span>
<span class="sd">    </span>
<span class="sd">    Returns: </span>
<span class="sd">        gridded (numpy array): data regridded to ICESat-2 map projection</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gridded</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataArrayNEW</span><span class="o">.</span><span class="n">values</span><span class="p">)):</span> 
        <span class="n">monthlyGridded</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">griddata</span><span class="p">((</span><span class="n">xptsNEW</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">yptsNEW</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> <span class="n">dataArrayNEW</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="p">(</span><span class="n">xptsIS2</span><span class="p">,</span> <span class="n">yptsIS2</span><span class="p">),</span> <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
        <span class="n">gridded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">monthlyGridded</span><span class="p">)</span>
    <span class="n">gridded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gridded</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">gridded</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id1">
<h2>Sea ice concentration<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>These datasets are on the same grid but have slightly different lat/lon values</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#map projection from ICESat-2 data (can be viewed in is2.projection.attrs[&#39;srid&#39;])</span>
<span class="n">out_proj</span> <span class="o">=</span> <span class="s1">&#39;EPSG:3411&#39;</span>
<span class="n">out_lons</span> <span class="o">=</span> <span class="n">is2_ds</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">values</span>
<span class="n">out_lats</span> <span class="o">=</span> <span class="n">is2_ds</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">values</span>

<span class="c1">#initialize map projection and project data to it</span>
<span class="n">mapProj</span> <span class="o">=</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">Proj</span><span class="p">(</span><span class="s2">&quot;+init=&quot;</span> <span class="o">+</span> <span class="n">out_proj</span><span class="p">)</span>
<span class="n">xptsIS2</span><span class="p">,</span> <span class="n">yptsIS2</span> <span class="o">=</span> <span class="n">mapProj</span><span class="p">(</span><span class="n">out_lons</span><span class="p">,</span> <span class="n">out_lats</span><span class="p">)</span>
<span class="n">xptsCDR</span><span class="p">,</span> <span class="n">yptsCDR</span> <span class="o">=</span> <span class="n">mapProj</span><span class="p">(</span><span class="n">cdr_da</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">cdr_da</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

<span class="c1">#regrid data </span>
<span class="n">cdr_regridded</span> <span class="o">=</span> <span class="n">regridToICESat2</span><span class="p">(</span><span class="n">cdr_da</span><span class="p">,</span> <span class="n">xptsCDR</span><span class="p">,</span> <span class="n">yptsCDR</span><span class="p">,</span> <span class="n">xptsIS2</span><span class="p">,</span> <span class="n">yptsIS2</span><span class="p">)</span>
<span class="n">cdr_regridded</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">cdr_regridded</span><span class="p">,</span> 
                             <span class="n">dims</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">],</span> 
                             <span class="n">coords</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="n">out_lats</span><span class="p">),</span> <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="n">out_lons</span><span class="p">),</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">cdr_da</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span><span class="p">},</span> 
                             <span class="n">name</span> <span class="o">=</span> <span class="n">cdr_da</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="n">cdr_regridded</span> <span class="o">=</span> <span class="n">cdr_regridded</span><span class="o">.</span><span class="n">to_dataset</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">8</span><span class="n">v</span><span class="o">/</span><span class="n">cr06mz0n3bjd5jr12_9v6n200000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_82215</span><span class="o">/</span><span class="mf">2547277114.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> 
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="c1">#regrid data</span>
<span class="ne">---&gt; </span><span class="mi">12</span> <span class="n">cdr_regridded</span> <span class="o">=</span> <span class="n">regridToICESat2</span><span class="p">(</span><span class="n">cdr_da</span><span class="p">,</span> <span class="n">xptsCDR</span><span class="p">,</span> <span class="n">yptsCDR</span><span class="p">,</span> <span class="n">xptsIS2</span><span class="p">,</span> <span class="n">yptsIS2</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="n">cdr_regridded</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">cdr_regridded</span><span class="p">,</span> 
<span class="g g-Whitespace">     </span><span class="mi">14</span>                              <span class="n">dims</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">],</span>

<span class="nn">/var/folders/8v/cr06mz0n3bjd5jr12_9v6n200000gn/T/ipykernel_82215/416546319.py</span> in <span class="ni">regridToICESat2</span><span class="nt">(dataArrayNEW, xptsNEW, yptsNEW, xptsIS2, yptsIS2)</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span>     <span class="n">gridded</span> <span class="o">=</span> <span class="p">[]</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span>     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataArrayNEW</span><span class="o">.</span><span class="n">values</span><span class="p">)):</span>
<span class="ne">---&gt; </span><span class="mi">17</span>         <span class="n">monthlyGridded</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">griddata</span><span class="p">((</span><span class="n">xptsNEW</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">yptsNEW</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> <span class="n">dataArrayNEW</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="p">(</span><span class="n">xptsIS2</span><span class="p">,</span> <span class="n">yptsIS2</span><span class="p">),</span> <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span>         <span class="n">gridded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">monthlyGridded</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span>     <span class="n">gridded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gridded</span><span class="p">)</span>

<span class="nn">~/opt/anaconda3/envs/icesat2_book/lib/python3.8/site-packages/xarray/core/dataarray.py</span> in <span class="ni">values</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">649</span>         <span class="nb">type</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">support</span> <span class="n">coercion</span> <span class="n">like</span> <span class="n">this</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">cupy</span><span class="p">)</span><span class="o">.</span>
<span class="g g-Whitespace">    </span><span class="mi">650</span>         <span class="sd">&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">651</span><span class="sd">         return self.variable.values</span>
<span class="g g-Whitespace">    </span><span class="mi">652</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">653</span><span class="sd">     @values.setter</span>

<span class="nn">~/opt/anaconda3/envs/icesat2_book/lib/python3.8/site-packages/xarray/core/variable.py</span> in <span class="ni">values</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">515</span><span class="sd">     def values(self):</span>
<span class="g g-Whitespace">    </span><span class="mi">516</span><span class="sd">         &quot;&quot;&quot;</span><span class="n">The</span> <span class="n">variable</span><span class="s1">&#39;s data as a numpy.ndarray&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">517</span>         <span class="k">return</span> <span class="n">_as_array_or_item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">518</span> 
<span class="g g-Whitespace">    </span><span class="mi">519</span>     <span class="nd">@values</span><span class="o">.</span><span class="n">setter</span>

<span class="nn">~/opt/anaconda3/envs/icesat2_book/lib/python3.8/site-packages/xarray/core/variable.py</span> in <span class="ni">_as_array_or_item</span><span class="nt">(data)</span>
<span class="g g-Whitespace">    </span><span class="mi">257</span>     <span class="n">TODO</span><span class="p">:</span> <span class="n">remove</span> <span class="n">this</span> <span class="p">(</span><span class="n">replace</span> <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">)</span> <span class="n">once</span> <span class="n">these</span> <span class="n">issues</span> <span class="n">are</span> <span class="n">fixed</span>
<span class="g g-Whitespace">    </span><span class="mi">258</span>     <span class="sd">&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">259</span><span class="sd">     data = np.asarray(data)</span>
<span class="g g-Whitespace">    </span><span class="mi">260</span><span class="sd">     if data.ndim == 0:</span>
<span class="g g-Whitespace">    </span><span class="mi">261</span><span class="sd">         if data.dtype.kind == &quot;M&quot;:</span>

<span class="nn">~/opt/anaconda3/envs/icesat2_book/lib/python3.8/site-packages/numpy/core/_asarray.py</span> in <span class="ni">asarray</span><span class="nt">(a, dtype, order, like)</span>
<span class="g g-Whitespace">    </span><span class="mi">100</span><span class="sd">         return _asarray_with_like(a, dtype=dtype, order=order, like=like)</span>
<span class="g g-Whitespace">    </span><span class="mi">101</span><span class="sd"> </span>
<span class="ne">--&gt; </span><span class="mi">102</span><span class="sd">     return array(a, dtype, copy=False, order=order)</span>
<span class="g g-Whitespace">    </span><span class="mi">103</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">104</span><span class="sd"> </span>

<span class="nn">~/opt/anaconda3/envs/icesat2_book/lib/python3.8/site-packages/dask/array/core.py</span> in <span class="ni">__array__</span><span class="nt">(self, dtype, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1486</span><span class="sd"> </span>
<span class="g g-Whitespace">   </span><span class="mi">1487</span><span class="sd">     def __array__(self, dtype=None, **kwargs):</span>
<span class="ne">-&gt; </span><span class="mi">1488</span><span class="sd">         x = self.compute()</span>
<span class="g g-Whitespace">   </span><span class="mi">1489</span><span class="sd">         if dtype and x.dtype != dtype:</span>
<span class="g g-Whitespace">   </span><span class="mi">1490</span><span class="sd">             x = x.astype(dtype)</span>

<span class="nn">~/opt/anaconda3/envs/icesat2_book/lib/python3.8/site-packages/dask/base.py</span> in <span class="ni">compute</span><span class="nt">(self, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">284</span><span class="sd">         dask.base.compute</span>
<span class="g g-Whitespace">    </span><span class="mi">285</span><span class="sd">         &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">286</span>         <span class="p">(</span><span class="n">result</span><span class="p">,)</span> <span class="o">=</span> <span class="n">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">traverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">287</span>         <span class="k">return</span> <span class="n">result</span>
<span class="g g-Whitespace">    </span><span class="mi">288</span> 

<span class="nn">~/opt/anaconda3/envs/icesat2_book/lib/python3.8/site-packages/dask/base.py</span> in <span class="ni">compute</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">566</span>         <span class="n">postcomputes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">__dask_postcompute__</span><span class="p">())</span>
<span class="g g-Whitespace">    </span><span class="mi">567</span> 
<span class="ne">--&gt; </span><span class="mi">568</span>     <span class="n">results</span> <span class="o">=</span> <span class="n">schedule</span><span class="p">(</span><span class="n">dsk</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="nn">    569     return repack([f(r, *a) for r, (f, a)</span> in <span class="ni">zip</span><span class="nt">(results, postcomputes)])</span>
<span class="g g-Whitespace">    </span><span class="mi">570</span> 

<span class="nn">~/opt/anaconda3/envs/icesat2_book/lib/python3.8/site-packages/dask/threaded.py</span> in <span class="ni">get</span><span class="nt">(dsk, result, cache, num_workers, pool, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">77</span>             <span class="n">pool</span> <span class="o">=</span> <span class="n">MultiprocessingPoolExecutor</span><span class="p">(</span><span class="n">pool</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">78</span> 
<span class="ne">---&gt; </span><span class="mi">79</span>     <span class="n">results</span> <span class="o">=</span> <span class="n">get_async</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">80</span>         <span class="n">pool</span><span class="o">.</span><span class="n">submit</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">81</span>         <span class="n">pool</span><span class="o">.</span><span class="n">_max_workers</span><span class="p">,</span>

<span class="nn">~/opt/anaconda3/envs/icesat2_book/lib/python3.8/site-packages/dask/local.py</span> in <span class="ni">get_async</span><span class="nt">(submit, num_workers, dsk, result, cache, get_id, rerun_exceptions_locally, pack_exception, raise_exception, callbacks, dumps, loads, chunksize, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">504</span>             <span class="k">while</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;waiting&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;ready&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;running&quot;</span><span class="p">]:</span>
<span class="g g-Whitespace">    </span><span class="mi">505</span>                 <span class="n">fire_tasks</span><span class="p">(</span><span class="n">chunksize</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">506</span>                 <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">res_info</span><span class="p">,</span> <span class="n">failed</span> <span class="ow">in</span> <span class="n">queue_get</span><span class="p">(</span><span class="n">queue</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">():</span>
<span class="g g-Whitespace">    </span><span class="mi">507</span>                     <span class="k">if</span> <span class="n">failed</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">508</span>                         <span class="n">exc</span><span class="p">,</span> <span class="n">tb</span> <span class="o">=</span> <span class="n">loads</span><span class="p">(</span><span class="n">res_info</span><span class="p">)</span>

<span class="nn">~/opt/anaconda3/envs/icesat2_book/lib/python3.8/site-packages/dask/local.py</span> in <span class="ni">queue_get</span><span class="nt">(q)</span>
<span class="g g-Whitespace">    </span><span class="mi">132</span> 
<span class="g g-Whitespace">    </span><span class="mi">133</span>     <span class="k">def</span> <span class="nf">queue_get</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">134</span>         <span class="k">return</span> <span class="n">q</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">135</span> 
<span class="g g-Whitespace">    </span><span class="mi">136</span> 

<span class="nn">~/opt/anaconda3/envs/icesat2_book/lib/python3.8/queue.py</span> in <span class="ni">get</span><span class="nt">(self, block, timeout)</span>
<span class="g g-Whitespace">    </span><span class="mi">168</span>             <span class="k">elif</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">169</span>                 <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qsize</span><span class="p">():</span>
<span class="ne">--&gt; </span><span class="mi">170</span>                     <span class="bp">self</span><span class="o">.</span><span class="n">not_empty</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">171</span>             <span class="k">elif</span> <span class="n">timeout</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">172</span>                 <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;timeout&#39; must be a non-negative number&quot;</span><span class="p">)</span>

<span class="nn">~/opt/anaconda3/envs/icesat2_book/lib/python3.8/threading.py</span> in <span class="ni">wait</span><span class="nt">(self, timeout)</span>
<span class="g g-Whitespace">    </span><span class="mi">300</span>         <span class="k">try</span><span class="p">:</span>    <span class="c1"># restore state no matter what (e.g., KeyboardInterrupt)</span>
<span class="g g-Whitespace">    </span><span class="mi">301</span>             <span class="k">if</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">302</span>                 <span class="n">waiter</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">303</span>                 <span class="n">gotit</span> <span class="o">=</span> <span class="kc">True</span>
<span class="g g-Whitespace">    </span><span class="mi">304</span>             <span class="k">else</span><span class="p">:</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id2">
<h2>ERA5 climate reanalysis<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Choose data variables of interest </span>
<span class="n">ERA5Vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;t2m&#39;</span><span class="p">,</span><span class="s1">&#39;msdwlwrf&#39;</span><span class="p">]</span>

<span class="c1">#initialize map projection and project data to it</span>
<span class="n">mapProj</span> <span class="o">=</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">Proj</span><span class="p">(</span><span class="s2">&quot;+init=&quot;</span> <span class="o">+</span> <span class="n">out_proj</span><span class="p">)</span>
<span class="n">xptsERA</span><span class="p">,</span> <span class="n">yptsERA</span> <span class="o">=</span> <span class="n">mapProj</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">ERA5</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">ERA5</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
<span class="n">xptsIS2</span><span class="p">,</span> <span class="n">yptsIS2</span> <span class="o">=</span> <span class="n">mapProj</span><span class="p">(</span><span class="n">out_lons</span><span class="p">,</span> <span class="n">out_lats</span><span class="p">)</span>

<span class="n">ERA5_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">ERA5Vars</span><span class="p">:</span> 
    <span class="n">ERA5gridded</span> <span class="o">=</span> <span class="n">regridToICESat2</span><span class="p">(</span><span class="n">ERA5</span><span class="p">[</span><span class="n">var</span><span class="p">],</span> <span class="n">xptsERA</span><span class="p">,</span> <span class="n">yptsERA</span><span class="p">,</span> <span class="n">xptsIS2</span><span class="p">,</span> <span class="n">yptsIS2</span><span class="p">)</span> 
    <span class="n">ERAArray</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">ERA5gridded</span><span class="p">,</span> 
                            <span class="n">dims</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">],</span> 
                            <span class="n">coords</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="n">out_lats</span><span class="p">),</span> <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="n">out_lons</span><span class="p">),</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span><span class="n">ERA5</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span><span class="p">},</span> 
                            <span class="n">name</span> <span class="o">=</span> <span class="n">var</span><span class="p">)</span>
    <span class="n">ERAArray</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">ERA5</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span> <span class="c1"># Maintain descriptive attributes</span>
    <span class="n">ERAArray</span> <span class="o">=</span> <span class="n">ERAArray</span><span class="o">.</span><span class="n">assign_attrs</span><span class="p">(</span><span class="n">ERA5</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>
    <span class="n">ERA5_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ERAArray</span><span class="p">)</span>
<span class="n">ERA5_regridded</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">ERA5_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id3">
<h2>PIOMAS sea ice thickness<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#project data to ICESat-2 map projection</span>
<span class="n">xptsPIO</span><span class="p">,</span> <span class="n">yptsPIO</span> <span class="o">=</span> <span class="n">mapProj</span><span class="p">(</span><span class="n">pio_da</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">pio_da</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

<span class="c1">#regrid data </span>
<span class="n">pio_regridded</span> <span class="o">=</span> <span class="n">regridToICESat2</span><span class="p">(</span><span class="n">pio_da</span><span class="p">,</span> <span class="n">xptsPIO</span><span class="p">,</span> <span class="n">yptsPIO</span><span class="p">,</span> <span class="n">xptsIS2</span><span class="p">,</span> <span class="n">yptsIS2</span><span class="p">)</span>
<span class="n">pio_regridded</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">pio_regridded</span><span class="p">,</span> 
                             <span class="n">dims</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">],</span> 
                             <span class="n">coords</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="n">out_lats</span><span class="p">),</span> <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="n">out_lons</span><span class="p">),</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">pio_da</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span><span class="p">},</span> 
                             <span class="n">name</span> <span class="o">=</span> <span class="n">pio_da</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="n">pio_regridded</span> <span class="o">=</span> <span class="n">pio_regridded</span><span class="o">.</span><span class="n">assign_attrs</span><span class="p">(</span><span class="n">pio_da</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>
<span class="n">pio_regridded</span> <span class="o">=</span> <span class="n">pio_regridded</span><span class="o">.</span><span class="n">to_dataset</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="sea-ice-motion-vectors">
<h2>Sea ice motion vectors<a class="headerlink" href="#sea-ice-motion-vectors" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#project data to ICESat-2 map projection</span>
<span class="n">xptsDRIFTS</span><span class="p">,</span> <span class="n">yptsDRIFTS</span> <span class="o">=</span> <span class="n">mapProj</span><span class="p">(</span><span class="n">drifts</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">drifts</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

<span class="c1"># Loop through variables of interest and regrid </span>
<span class="n">drifts_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;drifts_uT&#39;</span><span class="p">,</span> <span class="s1">&#39;drifts_vT&#39;</span><span class="p">,</span> <span class="s1">&#39;drifts_magnitude&#39;</span><span class="p">]:</span> 
    <span class="n">driftsGridded</span> <span class="o">=</span> <span class="n">regridToICESat2</span><span class="p">(</span><span class="n">drifts</span><span class="p">[</span><span class="n">var</span><span class="p">],</span> <span class="n">xptsDRIFTS</span><span class="p">,</span> <span class="n">yptsDRIFTS</span><span class="p">,</span> <span class="n">xptsIS2</span><span class="p">,</span> <span class="n">yptsIS2</span><span class="p">)</span>

    <span class="n">driftsArray</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">driftsGridded</span><span class="p">,</span> 
                               <span class="n">dims</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">],</span> 
                               <span class="n">coords</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="n">out_lats</span><span class="p">),</span> <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="n">out_lons</span><span class="p">),</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">drifts</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span><span class="p">},</span> 
                               <span class="n">name</span> <span class="o">=</span> <span class="n">var</span><span class="p">)</span>

    <span class="n">driftsArray</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">drifts</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span>
    <span class="n">driftsArray</span> <span class="o">=</span> <span class="n">driftsArray</span><span class="o">.</span><span class="n">assign_attrs</span><span class="p">(</span><span class="n">drifts</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>
    <span class="n">drifts_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">driftsArray</span><span class="p">)</span>

<span class="n">drifts_regridded</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">drifts_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="interpolate-icesat-2-variables">
<h1>4) Interpolate ICESat-2 variables<a class="headerlink" href="#interpolate-icesat-2-variables" title="Permalink to this headline">¶</a></h1>
<p>Here, we’ll interpolate some ICESat-2 variables using linear interpolation or a simple nearest neighbor interpolation function. Because ICESat-2 doesn’t provide full monthly coverage, interpolating fills missing grid cells with a best guess based on surrounding data. This helps avoid sampling biases when performing time series analyses, with the cavaet that this interpolation method is subjective. <br><br>
In order to define the interpolation bounds (so that we don’t try and interpolate over land, or other areas where there wouldn’t be sea ice!), we use the NOAA/NSIDC Climate Data Record of Passive Microwave Sea Ice Concentration dataset to infer the location of the sea ice. By setting <code class="docutils literal notranslate"><span class="pre">interpolation=True</span></code>, the code calls an interpolation function that is defined in the <code class="docutils literal notranslate"><span class="pre">misc_utils.py</span></code> module.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">is2_ds_interp</span> <span class="o">=</span> <span class="n">is2_interp2d</span><span class="p">(</span><span class="n">is2_ds</span><span class="p">,</span> <span class="n">cdr_da</span><span class="p">,</span> 
                             <span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="c1"># Interpolation method</span>
                             <span class="n">interp_var</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ice_thickness&quot;</span><span class="p">,</span><span class="s2">&quot;snow_depth&quot;</span><span class="p">,</span><span class="s2">&quot;snow_density&quot;</span><span class="p">,</span><span class="s2">&quot;freeboard&quot;</span><span class="p">,</span><span class="s2">&quot;ice_type&quot;</span><span class="p">,</span><span class="s2">&quot;ice_density&quot;</span><span class="p">])</span> <span class="c1"># Variables to interpolate</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="compile-and-save-final-dataset">
<h1>5) Compile and save final dataset<a class="headerlink" href="#compile-and-save-final-dataset" title="Permalink to this headline">¶</a></h1>
<p>Now that all the data is on the same grid, we can use xarray to merge all the datasets. We’ll also add the region mask as a coordinate.</p>
<div class="section" id="combine-datasets">
<h2>Combine datasets<a class="headerlink" href="#combine-datasets" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">final_ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">([</span><span class="n">is2_ds_interp</span><span class="p">,</span> <span class="n">cdr_regridded</span><span class="p">,</span> <span class="n">pio_regridded</span><span class="p">,</span> <span class="n">ERA5_regridded</span><span class="p">,</span> <span class="n">drifts_regridded</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="add-region-mask-as-a-coordinate-to-the-final-dataset">
<h2>Add region mask as a coordinate to the final dataset<a class="headerlink" href="#add-region-mask-as-a-coordinate-to-the-final-dataset" title="Permalink to this headline">¶</a></h2>
<p>This allows the user to easily mask regions when analyzing the data. See the region masking notebook for more information on the utility of this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">final_ds</span> <span class="o">=</span> <span class="n">final_ds</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">coords</span><span class="o">=</span><span class="n">regionMaskCoords</span><span class="p">)</span>
<span class="n">final_ds</span><span class="o">.</span><span class="n">region_mask</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">regionMaskAttrs</span>
<span class="n">final_ds</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;description&#39;</span><span class="p">:</span><span class="s1">&#39;Data used in ICESat-2 jupyter book&#39;</span><span class="p">,</span> 
                  <span class="s1">&#39;note&#39;</span><span class="p">:</span> <span class="s1">&#39;See individual data variables for references&#39;</span><span class="p">,</span> 
                  <span class="s1">&#39;creation date&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">())}</span>
<span class="nb">print</span><span class="p">(</span><span class="n">final_ds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;xarray.Dataset&gt;
Dimensions:                  (time: 30, y: 448, x: 304)
Coordinates:
  * time                     (time) datetime64[ns] 2018-11-01 ... 2021-04-01
    longitude                (y, x) float32 168.3 168.1 168.0 ... -10.18 -9.999
    latitude                 (y, x) float32 31.1 31.2 31.3 ... 34.68 34.58 34.47
    region_mask              (y, x) uint8 1 1 1 1 1 1 1 1 1 ... 1 1 1 1 1 1 1 1
Dimensions without coordinates: y, x
Data variables: (12/18)
    freeboard                (time, y, x) float32 nan nan nan ... nan nan nan
    ice_density              (time, y, x) float32 nan nan nan ... nan nan nan
    ice_thickness            (time, y, x) float32 nan nan nan ... nan nan nan
    ice_thickness_smoothed   (time, y, x) float64 nan nan nan ... nan nan nan
    ice_thickness_unc        (time, y, x) float32 nan nan nan ... nan nan nan
    ice_type                 (time, y, x) float32 nan nan nan ... nan nan nan
    ...                       ...
    piomas_ice_thickness     (time, y, x) float32 0.0 0.0 0.0 ... 0.0 0.0 0.0
    t2m                      (time, y, x) float32 nan 11.68 ... 7.272 7.321
    msdwlwrf                 (time, y, x) float32 nan 380.6 ... 335.3 334.9
    drifts_uT                (time, y, x) float32 nan nan nan ... nan nan nan
    drifts_vT                (time, y, x) float32 nan nan nan ... nan nan nan
    drifts_magnitude         (time, y, x) float32 nan nan nan ... nan nan nan
Attributes:
    description:    Data used in ICESat-2 jupyter book
    note:           See individual data variables for references
    creation date:  2021-09-20
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="save-data-to-local-machine-as-a-netcdf4-file">
<h2>Save data to local machine as a netcdf4 file<a class="headerlink" href="#save-data-to-local-machine-as-a-netcdf4-file" title="Permalink to this headline">¶</a></h2>
<p>We also uploaded this same file to the google storage bucket.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;icesat2-book-data.nc&#39;</span>
<span class="n">final_ds</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;NETCDF4&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;File &#39;</span> <span class="o">+</span> <span class="s1">&#39;&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39; saved to directory &#39;</span> <span class="o">+</span> <span class="s1">&#39;&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">localDirectory</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>File &quot;icesat2-book-data.nc&quot; saved to directory &quot;../icesat2-book-data/&quot;
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="atmospheric_variables.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Atmospheric variables</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="utils/markdown_rendering/read_data_utils.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Reading data from Google Cloud</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Nicole Keeney<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-177768395-1', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </body>
</html>